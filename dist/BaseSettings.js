"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Setting_1 = require("./Setting");
var BaseSettings = /** @class */ (function () {
    function BaseSettings() {
    }
    Object.defineProperty(BaseSettings.prototype, "settings", {
        // #endregion Properties (2)
        // #region Public Accessors (3)
        get: function () {
            return this._settings;
        },
        set: function (settings) {
            this._settings = settings;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseSettings.prototype, "version", {
        get: function () {
            return this._version;
        },
        enumerable: true,
        configurable: true
    });
    // #endregion Public Accessors (3)
    // #region Public Methods (4)
    BaseSettings.prototype.getSettingDefinitions = function () {
        var obj = {};
        this._getSettingDefinitions(this._settings, obj, '');
        return obj;
    };
    BaseSettings.prototype.getSettingObject = function (key) {
        var levels = key.split('.');
        var obj = this._settings;
        for (var i = 0; i < levels.length; i++) {
            obj = obj[levels[i]];
            if (obj instanceof Setting_1.Setting && i < levels.length - 1) {
                obj = obj.value;
            }
            else if (obj instanceof Setting_1.Setting) {
                return obj;
            }
            else if (!obj) {
                return;
            }
        }
        return;
    };
    BaseSettings.prototype.getSettings = function () {
        var obj = {};
        this._getSettings(this._settings, obj, '');
        return obj;
    };
    BaseSettings.prototype.toJSON = function () {
        return this._toJSON(this._settings);
    };
    // #endregion Public Abstract Methods (2)
    // #region Protected Methods (2)
    BaseSettings.prototype._fromJSON = function (settingsJSON, iterable) {
        if (!settingsJSON)
            return;
        for (var s in iterable) {
            if (iterable[s] instanceof Setting_1.Setting) {
                var setting = iterable[s];
                if (setting.persistent) {
                    var settingChildren = typeof setting.value === 'object' && setting.value !== null ? Object.values(setting.value) : [];
                    if (settingChildren.length !== 0 && settingChildren[0] instanceof Setting_1.Setting) {
                        this._fromJSON(settingsJSON[s], iterable[s].value);
                    }
                    else {
                        if (settingsJSON[s] !== undefined)
                            iterable[s].value = settingsJSON[s];
                    }
                }
            }
            else {
                this._fromJSON(settingsJSON[s], iterable[s]);
            }
        }
    };
    BaseSettings.prototype._toJSON = function (iterable) {
        var objJSON = {};
        for (var s in iterable) {
            if (iterable[s] instanceof Setting_1.Setting) {
                var setting = iterable[s];
                if (setting.persistent) {
                    var settingChildren = typeof setting.value === 'object' && setting.value !== null ? Object.values(setting.value) : [];
                    if (settingChildren.length !== 0 && settingChildren[0] instanceof Setting_1.Setting) {
                        objJSON[s] = this._toJSON(iterable[s].value);
                    }
                    else {
                        objJSON[s] = iterable[s].value;
                    }
                }
            }
            else if (iterable[s] instanceof String || typeof iterable[s] === 'string') {
                objJSON[s] = iterable[s];
            }
            else {
                objJSON[s] = this._toJSON(iterable[s]);
            }
        }
        return objJSON;
    };
    // #endregion Protected Methods (2)
    // #region Private Methods (2)
    BaseSettings.prototype._getSettingDefinitions = function (iterable, obj, path) {
        var parentPath = path ? path + '.' : '';
        for (var s in iterable) {
            if (iterable[s] instanceof Setting_1.Setting) {
                var setting = iterable[s];
                var settingChildren = typeof setting.value === 'object' && setting.value !== null ? Object.values(setting.value) : [];
                if (settingChildren.length !== 0 && settingChildren[0] instanceof Setting_1.Setting) {
                    if (iterable[s].desc) {
                        obj[parentPath + s] = {};
                        obj[parentPath + s].descripton = iterable[s].desc;
                        if (typeof iterable[s].type === 'string' || iterable[s].type instanceof String)
                            obj[parentPath + s].type = iterable[s].type;
                    }
                    this._getSettingDefinitions(iterable[s].value, obj, parentPath + s);
                }
                else {
                    if (iterable[s].desc) {
                        obj[parentPath + s] = {};
                        obj[parentPath + s].descripton = iterable[s].desc;
                        if (typeof iterable[s].type === 'string' || iterable[s].type instanceof String)
                            obj[parentPath + s].type = iterable[s].type;
                    }
                }
            }
            else if (!(iterable[s] instanceof String || typeof iterable[s] === 'string')) {
                this._getSettingDefinitions(iterable[s], obj, parentPath + s);
            }
        }
    };
    BaseSettings.prototype._getSettings = function (iterable, obj, path) {
        var parentPath = path ? path + '.' : '';
        for (var s in iterable) {
            if (iterable[s] instanceof Setting_1.Setting) {
                var setting = iterable[s];
                if (setting.persistent) {
                    var settingChildren = typeof setting.value === 'object' && setting.value !== null ? Object.values(setting.value) : [];
                    if (settingChildren.length !== 0 && settingChildren[0] instanceof Setting_1.Setting) {
                        this._getSettings(iterable[s].value, obj, parentPath + s);
                    }
                    else {
                        obj[parentPath + s] = iterable[s].value;
                    }
                }
            }
            else if (iterable[s] instanceof String || typeof iterable[s] === 'string') {
                obj[parentPath + s] = iterable[s];
            }
            else {
                this._getSettings(iterable[s], obj, parentPath + s);
            }
        }
    };
    return BaseSettings;
}());
exports.BaseSettings = BaseSettings;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzZVNldHRpbmdzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0Jhc2VTZXR0aW5ncy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFDQUFvQztBQUVwQztJQUFBO0lBc0tBLENBQUM7SUE1Skcsc0JBQVcsa0NBQVE7UUFKbkIsNEJBQTRCO1FBRTVCLCtCQUErQjthQUUvQjtZQUNJLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMxQixDQUFDO2FBRUQsVUFBb0IsUUFBNkI7WUFDN0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDOUIsQ0FBQzs7O09BSkE7SUFNRCxzQkFBVyxpQ0FBTzthQUFsQjtZQUNJLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN6QixDQUFDOzs7T0FBQTtJQUVELGtDQUFrQztJQUVsQyw2QkFBNkI7SUFFdEIsNENBQXFCLEdBQTVCO1FBQ0ksSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUVNLHVDQUFnQixHQUF2QixVQUF3QixHQUFXO1FBQy9CLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUIsSUFBSSxHQUFHLEdBQVEsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUM5QixLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNuQyxHQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLElBQUcsR0FBRyxZQUFZLGlCQUFPLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNo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QyxLQUFLLENBQUM7cUJBQ3pDO2lCQUNKO2FBQ0o7aUJBQU0sSUFBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksTUFBTSxJQUFJLE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBQztnQkFDdkUsR0FBRyxDQUFDLFVBQVUsR0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDbkM7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLFlBQVksQ0FBRSxRQUFRLENBQUMsQ0FBQyxDQUF5QixFQUFFLEdBQUcsRUFBRSxVQUFVLEdBQUMsQ0FBQyxDQUFDLENBQUM7YUFDOUU7U0FDSjtJQUNMLENBQUM7SUFHTCxtQkFBQztBQUFELENBQUMsQUF0S0QsSUFzS0M7QUF0S3FCLG9DQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVNldHRpbmdzLCBJQmFzZVNldHRpbmdzT2JqZWN0LCBJU2V0dGluZ3NWZXJzaW9uLCBJU2V0dGluZyB9IGZyb20gXCIuL2ludGVyZmFjZXMvaW50ZXJmYWNlc1wiO1xyXG5pbXBvcnQgeyBTZXR0aW5nIH0gZnJvbSBcIi4vU2V0dGluZ1wiO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VTZXR0aW5ncyBpbXBsZW1lbnRzIElTZXR0aW5ncyB7XHJcbiAgICAvLyAjcmVnaW9uIFByb3BlcnRpZXMgKDIpXHJcblxyXG4gICAgcHJvdGVjdGVkIF9zZXR0aW5nczogSUJhc2VTZXR0aW5nc09iamVjdDtcclxuICAgIHByb3RlY3RlZCBfdmVyc2lvbjogSVNldHRpbmdzVmVyc2lvbjtcclxuXHJcbiAgICAvLyAjZW5kcmVnaW9uIFByb3BlcnRpZXMgKDIpXHJcblxyXG4gICAgLy8gI3JlZ2lvbiBQdWJsaWMgQWNjZXNzb3JzICgzKVxyXG5cclxuICAgIHB1YmxpYyBnZXQgc2V0dGluZ3MoKTogSUJhc2VTZXR0aW5nc09iamVjdCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgc2V0dGluZ3Moc2V0dGluZ3M6IElCYXNlU2V0dGluZ3NPYmplY3QpIHtcclxuICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgdmVyc2lvbigpOiBJU2V0dGluZ3NWZXJzaW9uIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbjtcclxuICAgIH1cclxuXHJcbiAgICAvLyAjZW5kcmVnaW9uIFB1YmxpYyBBY2Nlc3NvcnMgKDMpXHJcblxyXG4gICAgLy8gI3JlZ2lvbiBQdWJsaWMgTWV0aG9kcyAoNClcclxuXHJcbiAgICBwdWJsaWMgZ2V0U2V0dGluZ0RlZmluaXRpb25zKCkge1xyXG4gICAgICAgIGxldCBvYmogPSB7fTtcclxuICAgICAgICB0aGlzLl9nZXRTZXR0aW5nRGVmaW5pdGlvbnModGhpcy5fc2V0dGluZ3MsIG9iaiwgJycpO1xyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFNldHRpbmdPYmplY3Qoa2V5OiBzdHJpbmcpOiBJU2V0dGluZzxhbnk+IHtcclxuICAgICAgICBsZXQgbGV2ZWxzID0ga2V5LnNwbGl0KCcuJyk7XHJcbiAgICAgICAgbGV0IG9iajogYW55ID0gdGhpcy5fc2V0dGluZ3M7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxldmVscy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBvYmogPSBvYmpbbGV2ZWxzW2ldXTtcclxuICAgICAgICAgICAgaWYob2JqIGluc3RhbmNlb2YgU2V0dGluZyAmJiBpIDwgbGV2ZWxzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgIG9iaiA9IG9iai52YWx1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKG9iaiBpbnN0YW5jZW9mIFNldHRpbmcpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKCFvYmopIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFNldHRpbmdzKCkge1xyXG4gICAgICAgIGxldCBvYmogPSB7fTtcclxuICAgICAgICB0aGlzLl9nZXRTZXR0aW5ncyh0aGlzLl9zZXR0aW5ncywgb2JqLCAnJyk7XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdG9KU09OKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90b0pTT04odGhpcy5fc2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vICNlbmRyZWdpb24gUHVibGljIE1ldGhvZHMgKDQpXHJcblxyXG4gICAgLy8gI3JlZ2lvbiBQdWJsaWMgQWJzdHJhY3QgTWV0aG9kcyAoMilcclxuXHJcbiAgICBwdWJsaWMgYWJzdHJhY3QgY29udmVydEZyb21QcmV2aW91c1ZlcnNpb24ob2JqOiBJU2V0dGluZ3MpOiBJU2V0dGluZ3M7XHJcbiAgICBwdWJsaWMgYWJzdHJhY3QgY29udmVydFRvUHJldmlvdXNWZXJzaW9uKCk6IElTZXR0aW5ncztcclxuXHJcbiAgICAvLyAjZW5kcmVnaW9uIFB1YmxpYyBBYnN0cmFjdCBNZXRob2RzICgyKVxyXG5cclxuICAgIC8vICNyZWdpb24gUHJvdGVjdGVkIE1ldGhvZHMgKDIpXHJcblxyXG4gICAgcHJvdGVjdGVkIF9mcm9tSlNPTihzZXR0aW5nc0pTT046IGFueSwgaXRlcmFibGU6IElCYXNlU2V0dGluZ3NPYmplY3QpIHtcclxuICAgICAgICBpZighc2V0dGluZ3NKU09OKSByZXR1cm47XHJcbiAgICAgICAgZm9yIChsZXQgcyBpbiBpdGVyYWJsZSkge1xyXG4gICAgICAgICAgICBpZiAoaXRlcmFibGVbc10gaW5zdGFuY2VvZiBTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2V0dGluZzogSVNldHRpbmc8YW55PiA9IChpdGVyYWJsZVtzXSBhcyBJU2V0dGluZzxhbnk+KTtcclxuICAgICAgICAgICAgICAgIGlmKHNldHRpbmcucGVyc2lzdGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZXR0aW5nQ2hpbGRyZW4gPSB0eXBlb2Ygc2V0dGluZy52YWx1ZSA9PT0gJ29iamVjdCcgJiYgc2V0dGluZy52YWx1ZSAhPT0gbnVsbCA/IE9iamVjdC52YWx1ZXMoc2V0dGluZy52YWx1ZSkgOiBbXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ0NoaWxkcmVuLmxlbmd0aCAhPT0gMCAmJiBzZXR0aW5nQ2hpbGRyZW5bMF0gaW5zdGFuY2VvZiBTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21KU09OKHNldHRpbmdzSlNPTltzXSwgaXRlcmFibGVbc10udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzSlNPTltzXSAhPT0gdW5kZWZpbmVkKSBpdGVyYWJsZVtzXS52YWx1ZSA9IHNldHRpbmdzSlNPTltzXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9mcm9tSlNPTihzZXR0aW5nc0pTT05bc10sIChpdGVyYWJsZVtzXSBhcyBJQmFzZVNldHRpbmdzT2JqZWN0KSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3RvSlNPTihpdGVyYWJsZTogSUJhc2VTZXR0aW5nc09iamVjdCkge1xyXG4gICAgICAgIGxldCBvYmpKU09OID0ge307XHJcbiAgICAgICAgZm9yIChsZXQgcyBpbiBpdGVyYWJsZSkge1xyXG4gICAgICAgICAgICBpZihpdGVyYWJsZVtzXSBpbnN0YW5jZW9mIFNldHRpbmcpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzZXR0aW5nOiBJU2V0dGluZzxhbnk+ID0gKGl0ZXJhYmxlW3NdIGFzIElTZXR0aW5nPGFueT4pO1xyXG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZy5wZXJzaXN0ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNldHRpbmdDaGlsZHJlbiA9IHR5cGVvZiBzZXR0aW5nLnZhbHVlID09PSAnb2JqZWN0JyAmJiBzZXR0aW5nLnZhbHVlICE9PSBudWxsID8gT2JqZWN0LnZhbHVlcyhzZXR0aW5nLnZhbHVlKSA6IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdDaGlsZHJlbi5sZW5ndGggIT09IDAgJiYgc2V0dGluZ0NoaWxkcmVuWzBdIGluc3RhbmNlb2YgU2V0dGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpKU09OW3NdID0gdGhpcy5fdG9KU09OKGl0ZXJhYmxlW3NdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpKU09OW3NdID0gaXRlcmFibGVbc10udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYoaXRlcmFibGVbc10gaW5zdGFuY2VvZiBTdHJpbmcgfHwgdHlwZW9mIGl0ZXJhYmxlW3NdID09PSAnc3RyaW5nJyl7XHJcbiAgICAgICAgICAgICAgICBvYmpKU09OW3NdID0gaXRlcmFibGVbc107XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmpKU09OW3NdID0gdGhpcy5fdG9KU09OKChpdGVyYWJsZVtzXSBhcyBJQmFzZVNldHRpbmdzT2JqZWN0KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9iakpTT047XHJcbiAgICB9XHJcblxyXG4gICAgLy8gI2VuZHJlZ2lvbiBQcm90ZWN0ZWQgTWV0aG9kcyAoMilcclxuXHJcbiAgICAvLyAjcmVnaW9uIFByaXZhdGUgTWV0aG9kcyAoMilcclxuXHJcbiAgICBwcml2YXRlIF9nZXRTZXR0aW5nRGVmaW5pdGlvbnMoaXRlcmFibGU6IElCYXNlU2V0dGluZ3NPYmplY3QsIG9iajogYW55LCBwYXRoPzogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHBhcmVudFBhdGggPSBwYXRoID8gcGF0aCArICcuJyA6ICcnOyBcclxuXHJcbiAgICAgICAgZm9yIChsZXQgcyBpbiBpdGVyYWJsZSkge1xyXG4gICAgICAgICAgICBpZihpdGVyYWJsZVtzXSBpbnN0YW5jZW9mIFNldHRpbmcpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzZXR0aW5nOiBJU2V0dGluZzxhbnk+ID0gKGl0ZXJhYmxlW3NdIGFzIElTZXR0aW5nPGFueT4pO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNldHRpbmdDaGlsZHJlbiA9IHR5cGVvZiBzZXR0aW5nLnZhbHVlID09PSAnb2JqZWN0JyAmJiBzZXR0aW5nLnZhbHVlICE9PSBudWxsID8gT2JqZWN0LnZhbHVlcyhzZXR0aW5nLnZhbHVlKSA6IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdDaGlsZHJlbi5sZW5ndGggIT09IDAgJiYgc2V0dGluZ0NoaWxkcmVuWzBdIGluc3RhbmNlb2YgU2V0dGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVyYWJsZVtzXS5kZXNjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtwYXJlbnRQYXRoICsgc10gPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW3BhcmVudFBhdGggKyBzXS5kZXNjcmlwdG9uID0gaXRlcmFibGVbc10uZGVzYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGl0ZXJhYmxlW3NdLnR5cGUgPT09ICdzdHJpbmcnIHx8IGl0ZXJhYmxlW3NdLnR5cGUgaW5zdGFuY2VvZiBTdHJpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbcGFyZW50UGF0aCArIHNdLnR5cGUgPSBpdGVyYWJsZVtzXS50eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFNldHRpbmdEZWZpbml0aW9ucyhpdGVyYWJsZVtzXS52YWx1ZSwgb2JqLCBwYXJlbnRQYXRoICsgcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVyYWJsZVtzXS5kZXNjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtwYXJlbnRQYXRoICsgc10gPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW3BhcmVudFBhdGggKyBzXS5kZXNjcmlwdG9uID0gaXRlcmFibGVbc10uZGVzYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGl0ZXJhYmxlW3NdLnR5cGUgPT09ICdzdHJpbmcnIHx8IGl0ZXJhYmxlW3NdLnR5cGUgaW5zdGFuY2VvZiBTdHJpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbcGFyZW50UGF0aCArIHNdLnR5cGUgPSBpdGVyYWJsZVtzXS50eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYoIShpdGVyYWJsZVtzXSBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2YgaXRlcmFibGVbc10gPT09ICdzdHJpbmcnKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZ2V0U2V0dGluZ0RlZmluaXRpb25zKChpdGVyYWJsZVtzXSBhcyBJQmFzZVNldHRpbmdzT2JqZWN0KSwgb2JqLCBwYXJlbnRQYXRoK3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2dldFNldHRpbmdzKGl0ZXJhYmxlOiBJQmFzZVNldHRpbmdzT2JqZWN0LCBvYmo6IGFueSwgcGF0aD86IHN0cmluZykge1xyXG4gICAgICAgIGxldCBwYXJlbnRQYXRoID0gcGF0aCA/IHBhdGggKyAnLicgOiAnJzsgXHJcblxyXG4gICAgICAgIGZvciAobGV0IHMgaW4gaXRlcmFibGUpIHtcclxuICAgICAgICAgICAgaWYoaXRlcmFibGVbc10gaW5zdGFuY2VvZiBTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2V0dGluZzogSVNldHRpbmc8YW55PiA9IChpdGVyYWJsZVtzXSBhcyBJU2V0dGluZzxhbnk+KTtcclxuICAgICAgICAgICAgICAgIGlmKHNldHRpbmcucGVyc2lzdGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZXR0aW5nQ2hpbGRyZW4gPSB0eXBlb2Ygc2V0dGluZy52YWx1ZSA9PT0gJ29iamVjdCcgJiYgc2V0dGluZy52YWx1ZSAhPT0gbnVsbCA/IE9iamVjdC52YWx1ZXMoc2V0dGluZy52YWx1ZSkgOiBbXTtcclxuICAgICAgICAgICAgICAgICAgICBpZihzZXR0aW5nQ2hpbGRyZW4ubGVuZ3RoICE9PSAwICYmIHNldHRpbmdDaGlsZHJlblswXSBpbnN0YW5jZW9mIFNldHRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2V0U2V0dGluZ3MoaXRlcmFibGVbc10udmFsdWUsIG9iaiwgcGFyZW50UGF0aCtzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbcGFyZW50UGF0aCtzXSA9IGl0ZXJhYmxlW3NdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmKGl0ZXJhYmxlW3NdIGluc3RhbmNlb2YgU3RyaW5nIHx8IHR5cGVvZiBpdGVyYWJsZVtzXSA9PT0gJ3N0cmluZycpe1xyXG4gICAgICAgICAgICAgICAgb2JqW3BhcmVudFBhdGgrc10gPSBpdGVyYWJsZVtzXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2dldFNldHRpbmdzKChpdGVyYWJsZVtzXSBhcyBJQmFzZVNldHRpbmdzT2JqZWN0KSwgb2JqLCBwYXJlbnRQYXRoK3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vICNlbmRyZWdpb24gUHJpdmF0ZSBNZXRob2RzICgyKVxyXG59Il19